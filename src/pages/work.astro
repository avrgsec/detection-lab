---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const projects = await getCollection('work');
const sortedProjects = projects.sort((a, b) => 
  (a.data.order || 999) - (b.data.order || 999)
);
---

<BaseLayout title="Work" description="Detection engineering projects and portfolio">
  <div class="mb-12">
    <h1 class="text-4xl font-light mb-4">Work & Projects</h1>
    <p class="text-text-secondary">
      Random things I've worked on
    </p>
  </div>

  {sortedProjects.length > 0 ? (
    <div class="space-y-12">
      {sortedProjects.map(async (project) => {
        const { Content } = await project.render();
        
        return (
          <article class="bg-bg-secondary border border-border rounded-lg p-8">
            <h2 class="text-2xl font-light mb-2">{project.data.title}</h2>
            <p class="text-text-secondary mb-6">{project.data.description}</p>
            
            <div class="prose prose-invert max-w-none">
              <Content />
            </div>
            
            {project.data.link && (
              <div class="mt-6">
                <a 
                  href={project.data.link}
                  target="_blank"
                  rel="noopener noreferrer"
                  class="inline-block px-6 py-3 bg-bg-primary border border-border rounded-lg hover:border-accent transition-colors"
                >
                  View Project â†’
                </a>
              </div>
            )}
          </article>
        );
      })}
    </div>
  ) : (
    <div class="bg-bg-secondary border border-border rounded-lg p-12 text-center">
      <h2 class="text-2xl font-light mb-4">Detection Lab</h2>
      <p class="text-text-secondary mb-8 max-w-2xl mx-auto">
        A collection of Sigma detection rules covering macOS, Windows, Linux, cloud, and network attacks. 
        Each detection is mapped to MITRE ATT&CK, tested in live environments, and available for free.
      </p>
      <div class="flex gap-4 justify-center">
        <a 
          href="/detections"
          class="px-6 py-3 bg-bg-primary border border-border rounded-lg hover:border-accent transition-colors"
        >
          Browse Detections
        </a>
        <a 
          href="https://github.com/avrgsec/detection-lab"
          target="_blank"
          rel="noopener noreferrer"
          class="px-6 py-3 bg-bg-primary border border-border rounded-lg hover:border-accent transition-colors"
        >
          View on GitHub
        </a>
      </div>
    </div>
  )}
</BaseLayout>

<style is:global>
  .prose h3 {
    font-size: 1.25rem;
    font-weight: 300;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
    color: #ffffff;
  }
  
  .prose p {
    margin-bottom: 1rem;
    color: #cccccc;
  }
  
  .prose ul {
    margin: 1rem 0;
    padding-left: 1.5rem;
  }
  
  .prose li {
    margin-bottom: 0.5rem;
    color: #cccccc;
  }
</style>
